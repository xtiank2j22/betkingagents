var Sportsbook;!function(a){var b=function(){function a(a,b,c,d,e,f,g,h,i){this.Grouping=a,this.Combinations=b||0,this.StakeForCombination=c||0,this.MinPercentageBonus=d||0,this.MaxPercentageBonus=e||0,this.MinWinForUnit=f||0,this.MaxWinForUnit=g||0,this.MinBonusForUnit=h||0,this.MaxBonusForUnit=i||0}return a.prototype.MinWin=function(){return this.MinWinForUnit*this.StakeForCombination},a.prototype.NetStakeMinWin=function(){return this.MinWinForUnit*this.StakeForCombinationTaxed},a.prototype.MaxWin=function(){return this.MaxWinForUnit*this.StakeForCombination},a.prototype.NetStakeMaxWin=function(){return this.MaxWinForUnit*this.StakeForCombinationTaxed},a.prototype.MinBonus=function(){return this.MinBonusForUnit*this.StakeForCombinationTaxed},a.prototype.MaxBonus=function(){return this.MaxBonusForUnit*this.StakeForCombinationTaxed},a}();a.CalculatedGroup=b;var c=function(){function a(){this.Groups=new Array}return a.prototype.getMaxAllowedStake=function(a,b,c,d,e){var f=this.getTotalWinForUnit(d)+this.getTotalBonusForUnit(d);0==f&&(f=1);var g=a/f*e;return b>0&&(g=g>b?b:g),g*=100,g=Math.floor(g),g/=100},a.prototype.getTotalWinForUnit=function(a){return a.length>0?this.Groups.filter(function(b){return a.indexOf(b.Grouping)!=-1}).sum("MaxWinForUnit"):0},a.prototype.getTotalBonusForUnit=function(a){return a.length>0?this.Groups.filter(function(b){return a.indexOf(b.Grouping)!=-1}).sum("MaxBonusForUnit"):0},a}();a.CalculatedCoupon=c;var d=function(){function a(a,b){this.MatchId=a,this.Index=b}return a.prototype.getKey=function(){return this.MatchId+"_"+this.Index},a}(),e=function(){function a(a,b){if(a&&b){if(a<0||b<0)throw new Error("Negative parameter in constructor");this.n=a,this.k=b,this.data=new Array;for(var c=0;c<b;c++)this.data[c]=c}}return a.prototype.successor=function(){if(0==this.data.length||this.data[0]==this.n-this.k)return null;var b=new a(this.n,this.k),c=0;for(c=0;c<this.k;c++)b.data[c]=this.data[c];for(c=this.k-1;c>0&&b.data[c]==this.n-this.k+c;)c--;b.data[c]++;for(var d=c;d<this.k-1;d++)b.data[d+1]=b.data[d]+1;return b},a.prototype.first=function(){for(var b=new a(this.n,this.k),c=0;c<b.k;++c)b.data[c]=c;return b},a.prototype.applyTo=function(a){if(a.length!=this.n)throw new Error("Array size not equal to Combination order in ApplyTo()");for(var b=new Array,c=0;c<this.k;c++)b[c]=a[this.data[c]];return b},a.prototype.choose=function(a,b){if(a<0||b<0)throw new Error("Invalid negative parameter in Choose()");if(a<b)return 0;if(a==b||0==b)return 1;var c=0,d=0;b<a-b?(c=a-b,d=b):(c=b,d=a-b);for(var e=c+1,f=2;f<=d;++f)e=e*(c+f)/f;return e},a}(),f=(function(){function a(){}return a}(),function(){function a(){}return a.prototype.create2Darray=function(a){for(var b=[],c=0;c<a;c++)b[c]=[];return b},a.prototype.chooseFromSets=function(a,b){var c=a.length;if(0==b||b>c)return 0;for(var d=0,e=this.create2Darray(b+1),f=1;f<=c-b+1;f++)if(1==f)for(var g=1;g<=b;g++)e[g][f]=a.take(g).reduce(function(a,b){return a*b},1),d=e[g][f];else{e[1][f]=a.take(f).reduce(function(a,b){return a+b},0),d=e[1][f];for(var g=2;g<=b;g++)e[g][f]=e[g][f-1]+e[g-1][f]*a[g+f-2],d=e[g][f]}return d},a}()),g=function(){function f(){}return f.prototype.getSlotKeyFromString=function(a){var b=a.split("_"),c=parseInt(b[0]),e=parseInt(b[1]);return new d(c,e)},f.prototype.getOddsForSlotKeyMap=function(b){for(var c={},e=0;e<b.Odds.length;e++){var f=b.Odds[e];switch(f.CompatibilityLevel){case a.CompatibilityLevel.IncompatibleMarket:var g=new Array;for(var h in c){var i=this.getSlotKeyFromString(h);if(i.MatchId==f.MatchId&&0==i.Index)g.push(i);else if(i.MatchId==f.MatchId&&i.Index>0)throw new Error("Mixed CompatibilityLevel on odds")}if(g.length>1)throw new Error("Wrong oddsForSlotKeyMap construction");if(0==g.length){var j=new d(f.MatchId,0),k=new Array;k.push(f),c[j.getKey()]=k}else{var j=g[0],l=c[j.getKey()];l.push(f)}break;case a.CompatibilityLevel.CompatibleMarket:var g=new Array;for(var h in c){var i=this.getSlotKeyFromString(h);i.MatchId==f.MarketId&&g.push(i)}if(g.length>0){var m=g.max("Index"),j=new d(f.MatchId,m+1),k=new Array;k.push(f),c[j.getKey()]=k}else{var j=new d(f.MatchId,1),k=new Array;k.push(f),c[j.getKey()]=k}}}return c},f.prototype.calcCombinations=function(a){var d=Math.min(a.BetCouponGlobalVariable.MaxCombinationsByGrouping,a.BetCouponGlobalVariable.MaxCouponCombinations);a.Odds.length>0&&a.Odds.filter(function(a){return a.Fixed}).length==a.Odds.length&&(a.Odds[0].Fixed=!1);var f=new Array,g=this.getOddsForSlotKeyMap(a),h=new Array,i=new Array,j=0,k=!1,l=new Array;for(var m in g){var n=g[m];n[0].Fixed?h.push(n[0]):(i.push(n),l.push(n.length)),j+=1,n.length>1&&(k=!0)}for(var o=h.length>0?h.length:1,p=0;p<=j;p++){var q=null;p>0&&(q=new b(p),p<o&&(q.Combinations=0)),f.push(q)}if(h.length>0&&(f[h.length].Combinations=0),k)for(var r=i.length;r>0;r--){var s=this.calcCombinationsForCrossCombinationsBetGroup(r,l,d);f[r+h.length].Combinations=s}else for(var r=i.length;r>0;r--){var t=i.length,u=(new e).choose(t,r);d>u?f[r+h.length].Combinations=u:f[r+h.length].Combinations=-1}for(var v=a.MaxGrouping(),w=0;w<f.length;w++)(null==f[w]||f[w].Grouping>v)&&(f.splice(w,1),w--);var x=new c;return f.forEach(function(a){return x.Groups.push(a)}),x},f.prototype.calcCombinationsForCrossCombinationsBetGroup=function(a,b,c){var d=h.chooseFromSets(b,a);return d>c?-1:d},f.prototype.calcPotentialWins=function(d,f,g,h){var i=a.TaxationService.Instance().getModule(g,h),j=Math.min(d.BetCouponGlobalVariable.MaxCombinationsByGrouping,d.BetCouponGlobalVariable.MaxCouponCombinations),k=this.getOddsForSlotKeyMap(d),l=new Array,m=new Array;for(var n in k){var o=k[n];o[0].Fixed?l.push(o[0]):m.push(o)}for(var p=new Array,q=new Array,r=0;r<m.length;r++)p[r]=m[r].sortDesc("OddValue")[0],q[r]=m[r].sortAsc("OddValue")[0];for(var s=new Array,t=0;t<d.Groupings.length;t++){var u=d.Groupings[t];if(u.Combinations>0){var v=u.Stake,w=new a.TaxConfiguration(d.BetCouponGlobalVariable.IsVirtualsInstallation);i&&(v=i.calculateTurnoverTax(new a.TurnoverTaxParameter(new Date,u.Stake,w)).totalAfterTax);var x=new b(u.Grouping);x.Combinations=u.Combinations,x.StakeForCombination=u.Stake,x.StakeForCombinationTaxed=v,s.push(x)}}if(0==d.Groupings.length&&l.length+m.length==1){var y=1;m.length>0&&(y=m[0].length);var x=new b(1);x.Combinations=y,x.StakeForCombination=d.getStake()/y,s.push(x)}for(var z=0,A=1,t=0;t<l.length;t++){var B=l[t];A*=B.OddValue,A=Number(A.toFixed(10)),B.OddValue>=d.BetCouponGlobalVariable.MinBonusOdd&&z++}for(var t=0;t<s.length;t++){var x=s[t],C=m.length,D=x.Grouping-l.length,E=(new e).choose(C,D),F=0,G=0;if(j>E)for(var H=new e(C,D),I=0;I<E;I++){for(var J=z,K=A,L=H.applyTo(p),M=0;M<L.length;M++){var N=L[M];K*=N.OddValue,K=Number(K.toFixed(10)),N.OddValue>=d.BetCouponGlobalVariable.MinBonusOdd&&J++}var O=this.bonusPercentageFromNumberOfEvents(f,J);F+=K,G+=K*O,H=H.successor(),x.MaxPercentageBonus=O}x.MaxWinForUnit=F,x.MaxBonusForUnit=G;for(var P=A,Q=z,R=q.sortAsc("OddValue"),S=R.take(D),I=0;I<S.length;I++){var N=S[I];P*=N.OddValue,P=Number(P.toFixed(10)),N.OddValue>=d.BetCouponGlobalVariable.MinBonusOdd&&Q++}var T=this.bonusPercentageFromNumberOfEvents(f,Q);x.MinWinForUnit=P,x.MinBonusForUnit=P*T,x.MinPercentageBonus=T}var U=new c;return s.forEach(function(a){return U.Groups.push(a)}),U},f.prototype.bonusPercentageFromNumberOfEvents=function(a,b){if(0==a.length)return 0;if(b<a.min("NumberOfEvents"))return 0;if(b>a.max("NumberOfEvents"))return 0;var c=a.filter(function(a){return a.NumberOfEvents==b});if(c.length>0){var d=c[0];return d.Percentage/100}throw new Error("Can't find the bonus percentage for "+b+" events")},f}();a.CouponCalculation=g;var h=new f}(Sportsbook||(Sportsbook={}));var Sportsbook;!function(a){var b=function(){function a(a){this.maxAmount=void 0,this.validTo=void 0,$.extend(this,a)}return a}();a.TaxBracket=b}(Sportsbook||(Sportsbook={}));var Sportsbook;!function(a){!function(a){a[a.None=1]="None",a[a.TaxOnWinningsExclStake=2]="TaxOnWinningsExclStake",a[a.TaxOnStakeAndWinnings=3]="TaxOnStakeAndWinnings"}(a.TaxMode||(a.TaxMode={}));a.TaxMode}(Sportsbook||(Sportsbook={}));var Sportsbook;!function(a){var b=function(){function a(a,b){this.isVirtual=!1,this.twoDecimalPrecision=!1,this.isVirtual=a||!1,this.twoDecimalPrecision=b||!1}return a}();a.TaxConfiguration=b;var c=function(){function a(a,c,d){this.date=a,this.stake=c,this.taxConfiguration=d||new b}return a}();a.TurnoverTaxParameter=c;var d=function(){function a(a,c,d,e){this.date=a,this.wonAmount=c,this.stake=d,this.taxConfiguration=e||new b}return a}();a.WithholdingTaxParameter=d}(Sportsbook||(Sportsbook={}));var Sportsbook;!function(a){var b=function(){function a(a){$.extend(this,a)}return a}();a.TaxDetail=b}(Sportsbook||(Sportsbook={}));var Sportsbook;!function(a){!function(a){a[a.WithholdingTax=1]="WithholdingTax",a[a.TurnoverTax=2]="TurnoverTax"}(a.TaxReason||(a.TaxReason={}));a.TaxReason}(Sportsbook||(Sportsbook={}));var Sportsbook;!function(a){var b=function(){function a(a){this.details=[],this.totalTaxed=0,this.totalAfterTax=0,$.extend(this,a)}return a}();a.TaxResult=b}(Sportsbook||(Sportsbook={}));var Sportsbook;!function(a){var b=function(){function a(a){$.extend(this,a)}return a}();a.TaxInfo=b}(Sportsbook||(Sportsbook={})),Array.prototype.unique=function(a){for(var b={},c=[],d=0;d<this.length;d++){var e=this[d];"undefined"==typeof b[e[a]]&&c.push(e),b[e[a]]=0}return c},Array.prototype.sum=function(a){for(var b=0,c=0;c<this.length;c++){var d=this[c];b+=d[a]}return b},Array.prototype.min=function(a){if(this.length>1){var b=this.reduce(function(b,c){return b[a]<c[a]?b:c});return b[a]}var c=this[0];return c[a]},Array.prototype.max=function(a){if(this.length>1){var b=this.reduce(function(b,c){return b[a]>c[a]?b:c});return b[a]}var c=this[0];return c[a]},Array.prototype.take=function(a){return this.slice(0,a)},Array.prototype.sortAsc=function(a){return this.sort(function(b,c){return b[a]>c[a]?1:b[a]<c[a]?-1:0})},Array.prototype.sortMultipleAsc=function(a,b,c){var d=function(a,b){return a>b?1:a<b?-1:0};return this.sort(function(e,f){return d(e[a],f[a])||d(e[b],f[b])||d(e[c],f[c])})},Array.prototype.sortDesc=function(a){return this.sort(function(b,c){return b[a]>c[a]?-1:b[a]<c[a]?1:0})},Array.prototype.remove=function(a,b){for(var c=0;c<this.length;c++){var d=this[c];if(d[a]==b)return this.splice(c,1),!0}return!1},Array.prototype.removeAll=function(a,b){for(var c=0,d=0;d<this.length;d++){var e=this[d];e[a]==b&&(this.splice(d,1),c++)}return c},Array.prototype.find=function(a){if(null==this)throw TypeError('"this" is null or not defined');var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw TypeError("predicate must be a function");for(var d=arguments[1],e=0;e<c;){var f=b[e];if(a.call(d,f,e,b))return f;e++}};var Sportsbook;!function(a){var b=function(){function a(a){if(this._keys=new Array,this._values=new Array,a)for(var b in a)this.add(Number(b),a[b])}return a.prototype.add=function(a,b){this[a.toString()]=b,this._keys.push(a),this._values.push(b)},a.prototype.remove=function(a){var b=this._keys.indexOf(a,0);this._keys.splice(b,1),this._values.splice(b,1),delete this[a.toString()]},a.prototype.containsKey=function(a){return"undefined"!=typeof this[a.toString()]},a.prototype.keys=function(){return this._keys},a.prototype.values=function(){return this._values},a}();a.Dictionary=b}(Sportsbook||(Sportsbook={}));var Sportsbook;!function(a){var b=function(){function a(){}return a}();a.AbstractFunction=b}(Sportsbook||(Sportsbook={}));var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},Sportsbook;!function(a){var b=function(b){function c(){b.apply(this,arguments),this.taxMode=a.TaxMode.None}return __extends(c,b),c.prototype.turnoverTaxFunction=function(){return function(b,c){return new a.TaxResult({taxReason:a.TaxReason.TurnoverTax,totalAfterTax:c.stake,totalTaxed:0,details:[]})}},c.prototype.withholdingTaxFunction=function(){return function(b,c){return new a.TaxResult({taxReason:a.TaxReason.WithholdingTax,totalAfterTax:c.wonAmount,totalTaxed:0,details:[]})}},c}(a.AbstractFunction);a.NoTaxFunction=b}(Sportsbook||(Sportsbook={}));var Sportsbook;!function(a){var b=function(b){function c(){b.apply(this,arguments),this._taxGate=1e3,this.taxMode=a.TaxMode.TaxOnWinningsExclStake}return __extends(c,b),c.prototype.turnoverTaxFunction=function(){return function(b,c){if(c.taxConfiguration&&c.taxConfiguration.isVirtual)return new a.TaxResult({taxReason:a.TaxReason.TurnoverTax,totalAfterTax:c.stake,totalTaxed:0,details:[new a.TaxDetail({taxPercentage:0,taxableAmount:0,taxedAmount:0})]});var d=0,e=0,f=0,g=c.stake,h=c.stake,i=0,j=[],k=b.filter(function(b){return b.type===a.TaxType.TurnoverTax&&b.validFrom<c.date&&(void 0===b.validTo||b.validTo>c.date)});return k.forEach(function(b){return e=void 0!==b.maxAmount?Math.min(g,b.maxAmount):g,g-=e,b.taxPercentage<=0?(i+=e,void(h-=e)):void(e<=0||(d=e*b.taxPercentage/(1+b.taxPercentage),c.taxConfiguration.twoDecimalPrecision&&(d=Math.round(100*d)/100),j.push(new a.TaxDetail({taxPercentage:b.taxPercentage,taxableAmount:e,taxedAmount:d})),h-=d,f+=d))}),new a.TaxResult({taxReason:a.TaxReason.TurnoverTax,totalAfterTax:Math.max(0,h+i),totalTaxed:Math.max(0,f),details:j})}},c.prototype.withholdingTaxFunction=function(){var b=this;return function(c,d){if(d.wonAmount<=d.stake)return new a.TaxResult({taxReason:a.TaxReason.WithholdingTax,totalAfterTax:d.wonAmount,totalTaxed:0,details:[]});var e=0,f=0,g=0,h=d.wonAmount-d.stake,i=d.wonAmount-d.stake,j=d.stake,k=[];if(i>b._taxGate){var l=c.filter(function(b){return b.type===a.TaxType.WithholdingTax&&b.validFrom<d.date&&(void 0===b.validTo||b.validTo>d.date)});l.forEach(function(b){return f=void 0!==b.maxAmount?Math.min(h,b.maxAmount):h,h-=f,b.taxPercentage<=0?(j+=f,void(i-=f)):void(f<=0||(e=f*b.taxPercentage,d.taxConfiguration.twoDecimalPrecision&&(e=Math.round(100*e)/100),k.push(new a.TaxDetail({taxPercentage:b.taxPercentage,taxableAmount:f,taxedAmount:e})),i-=e,g+=e))})}return new a.TaxResult({taxReason:a.TaxReason.WithholdingTax,totalAfterTax:Math.max(0,i+j),totalTaxed:Math.max(0,g),details:k})}},c}(a.AbstractFunction);a.EthiopiaTaxFunction=b}(Sportsbook||(Sportsbook={}));var Sportsbook;!function(a){var b=function(b){function c(){b.apply(this,arguments),this.taxMode=a.TaxMode.None}return __extends(c,b),c.prototype.turnoverTaxFunction=function(){return function(b,c){return new a.TaxResult({taxReason:a.TaxReason.TurnoverTax,totalAfterTax:c.stake,totalTaxed:0,details:[]})}},c.prototype.withholdingTaxFunction=function(){return function(b,c){return new a.TaxResult({taxReason:a.TaxReason.WithholdingTax,totalAfterTax:c.wonAmount,totalTaxed:0,details:[]})}},c}(a.AbstractFunction);a.GhanaTaxFunction=b}(Sportsbook||(Sportsbook={}));var Sportsbook;!function(a){var b=function(){function b(){this._withHoldingFuncs=[],this._turnoverFuncs=[]}return b.Instance=function(){return b._instance||(b._instance=new b,this.initFunctions()),b._instance},b.initFunctions=function(){var c=new a.NoTaxFunction;if(!b.Instance().tryAddFunction(c.taxMode,c))throw new Error("Failed to instantiate 'No Tax' Functions");var d=new a.EthiopiaTaxFunction;if(!b.Instance().tryAddFunction(d.taxMode,d))throw new Error("Failed to instantiate 'Ethiopia Tax' Functions");var e=new a.KenyaTaxFunction;if(!b.Instance().tryAddFunction(e.taxMode,e))throw new Error("Failed to instantiate 'Kenya Tax' Functions");var f=new a.GhanaTaxFunction;if(!b.Instance().tryAddFunction(f.taxMode,f))throw new Error("Failed to instantiate 'Ghana Tax' Functions")},b.prototype.tryAddFunction=function(a,b){try{this._withHoldingFuncs.push({key:a,value:b.withholdingTaxFunction()}),this._turnoverFuncs.push({key:a,value:b.turnoverTaxFunction()})}catch(a){return!1}return!0},b.prototype.calculateWithholdingTax=function(a){var b=this._withHoldingFuncs.find(function(b){return b.key===a});return b?b.value:void 0},b.prototype.calculateTurnoverTax=function(a){var b=this._turnoverFuncs.find(function(b){return b.key===a});return b?b.value:void 0},b}();a.FunctionRepository=b}(Sportsbook||(Sportsbook={}));var Sportsbook;!function(a){var b=function(){function b(b,c){this.taxBrackets=[],this.taxMode=a.TaxMode.None,this.brandID=b,this.isRetail=c}return b.prototype.calculateTurnoverTax=function(b){return a.FunctionRepository.Instance().calculateTurnoverTax(this.taxMode)(this.taxBrackets,b)},b.prototype.calculateWithholdingTax=function(b){return a.FunctionRepository.Instance().calculateWithholdingTax(this.taxMode)(this.taxBrackets,b)},b}();a.NoTaxModule=b}(Sportsbook||(Sportsbook={}));var Sportsbook;!function(a){var b=function(){function b(b,c){this.taxBrackets=[],this.taxMode=a.TaxMode.TaxOnWinningsExclStake,this.taxBrackets.push(new a.TaxBracket({taxationOrder:0,type:a.TaxType.TurnoverTax,maxAmount:void 0,validFrom:new Date(2020,11,9,8,30,0),validTo:void 0,taxPercentage:.15}),new a.TaxBracket({taxationOrder:0,type:a.TaxType.WithholdingTax,maxAmount:void 0,validFrom:new Date(2019,0,1),validTo:void 0,taxPercentage:.15})),this.brandID=b,this.isRetail=c}return b.prototype.calculateTurnoverTax=function(b){return a.FunctionRepository.Instance().calculateTurnoverTax(this.taxMode)(this.taxBrackets,b)},b.prototype.calculateWithholdingTax=function(b){return a.FunctionRepository.Instance().calculateWithholdingTax(this.taxMode)(this.taxBrackets,b)},b}();a.EthiopiaTaxModule=b}(Sportsbook||(Sportsbook={}));var Sportsbook;!function(a){var b=function(){function b(b,c){this.taxBrackets=[],this.taxMode=a.TaxMode.None,this.brandID=b,this.isRetail=c}return b.prototype.calculateTurnoverTax=function(b){return a.FunctionRepository.Instance().calculateTurnoverTax(this.taxMode)(this.taxBrackets,b)},b.prototype.calculateWithholdingTax=function(b){return a.FunctionRepository.Instance().calculateWithholdingTax(this.taxMode)(this.taxBrackets,b)},b}();a.GhanaTaxModule=b}(Sportsbook||(Sportsbook={}));var Sportsbook;!function(a){var b=function(){function b(){this._taxModules=[]}return b.Instance=function(){return b._instance||(b._instance=new b,this.initModules()),b._instance},b.initModules=function(){b.Instance().tryAddModule(new a.NoTaxModule(1901,!1)),b.Instance().tryAddModule(new a.EthiopiaTaxModule(1902,!1)),b.Instance().tryAddModule(new a.KenyaTaxModule(1903,!1)),b.Instance().tryAddModule(new a.NoTaxModule(1903,!0)),b.Instance().tryAddModule(new a.NoTaxModule(1904,!1))},b.prototype.getModule=function(a,b){var c=this._taxModules.find(function(c){return c.key===a&&c.isRetail===b});return c?c.value:void 0},b.prototype.getTaxModes=function(){return this._taxModules.map(function(b){return new a.TaxInfo({brandID:b.value.brandID,isRetail:b.value.isRetail,taxMode:b.value.taxMode})})},b.prototype.tryAddModule=function(a){if(!this.addModule(a.brandID,a.isRetail,a))throw new Error("Failed to instantiate tax module for brand "+a.brandID+" and isRetail "+a.isRetail)},b.prototype.addModule=function(a,b,c){try{this._taxModules.push({key:a,isRetail:b,value:c})}catch(a){return!1}return!0},b}();a.TaxModuleSelector=b}(Sportsbook||(Sportsbook={}));var Sportsbook;!function(a){var b=function(){function b(){}return b.Instance=function(){return b._instance||(b._instance=new b),b._instance},b.prototype.getModule=function(b,c){return a.TaxModuleSelector.Instance().getModule(b,c)},b.prototype.getTaxModes=function(){return a.TaxModuleSelector.Instance().getTaxModes()},b}();a.TaxationService=b}(Sportsbook||(Sportsbook={}));var Sportsbook;!function(a){var b=function(){function a(a,b){void 0!=a&&(this.ResponseStatus=a),b&&(this.BetCoupon=b)}return a}();a.BetCouponResponse=b,function(a){a[a.Success=0]="Success",a[a.Error=1]="Error",a[a.AlreadyExistsError=2]="AlreadyExistsError",a[a.OutrightError=3]="OutrightError",a[a.CouponContainsUniqueOddError=4]="CouponContainsUniqueOddError",a[a.CannotInsertUniqueOddError=5]="CannotInsertUniqueOddError",a[a.MaxNoOfSelectionsError=6]="MaxNoOfSelectionsError",a[a.MaxNoOfEventsError=7]="MaxNoOfEventsError",a[a.CannotInsertFixedOddOnCrossCombinationError=8]="CannotInsertFixedOddOnCrossCombinationError",a[a.CannotInsertCrossCombinationOnLiveError=9]="CannotInsertCrossCombinationOnLiveError",a[a.BankerOnLiveCouponError=10]="BankerOnLiveCouponError",a[a.IncompatibleEvents=11]="IncompatibleEvents",a[a.MinCombinabilityOddsError=12]="MinCombinabilityOddsError",a[a.OddNotExists=13]="OddNotExists",a[a.CannotRemoveOddError=14]="CannotRemoveOddError",a[a.CannotRemoveGroupingError=15]="CannotRemoveGroupingError",a[a.GameplayWrong=16]="GameplayWrong",a[a.OddChanged=17]="OddChanged",a[a.EventExpired=18]="EventExpired",a[a.UnderMinBetStake=19]="UnderMinBetStake",a[a.OverMaxBetStake=20]="OverMaxBetStake",a[a.CouponLimitReached=21]="CouponLimitReached",a[a.UnderMinBetGroupStake=22]="UnderMinBetGroupStake",a[a.OverMaxBetGroupStake=23]="OverMaxBetGroupStake"}(a.ResponseStatus||(a.ResponseStatus={}));var c=a.ResponseStatus,d=function(){function a(){}return a}();a.Bonus=d,function(a){a[a.Unknown=0]="Unknown",a[a.SingleBet=1]="SingleBet",a[a.MultipleBet=2]="MultipleBet",a[a.CombinationsBet=3]="CombinationsBet"}(a.CouponType||(a.CouponType={}));a.CouponType;!function(a){a[a.Unknown=0]="Unknown",a[a.Tournament=1]="Tournament",a[a.MatchOutright=2]="MatchOutright",a[a.Market=3]="Market",a[a.Selection=4]="Selection"}(a.LimitItemType||(a.LimitItemType={}));var e=(a.LimitItemType,function(){function a(){}return a}());a.SelectionNoWinValue=e,function(a){a[a.IncompatibleMarket=0]="IncompatibleMarket",a[a.CompatibleMarket=1]="CompatibleMarket"}(a.CompatibilityLevel||(a.CompatibilityLevel={}));var f=a.CompatibilityLevel,g=function(){function a(){}return a}();a.Selection=g;var h=function(){function a(a){if(this.Fixed=!1,a){this.IDSport=a.sportId,this.SportName=a.sportName,this.EventId=a.categoryId,this.EventName=a.categoryName,this.TournamentId=a.tournamentId,this.TournamentName=a.tournamentName,this.MatchId=a.matchId,this.ProviderEventId=a.matchProviderId,this.MatchName=a.matchName,this.EventDate=a.matchDate,this.SelectionId=a.oddId,this.IDSelectionType=a.selectionTypeId,this.SelectionShortcut=a.selectionShortcut,this.MarketId=a.marketId,this.MarketTypeId=a.marketTypeId;var b=/\((-?\d+(?:\.\d+)?|(-?\d+\:-?\d+)?|(-?\d+\:-?\d+\.-?\d+)?|(-?\d+\.-?\d+\:-?\d+)?)\)/,c=b.exec(a.marketName),d=b.exec(a.selectionName),e=!1;void 0!=c?(e=!0,this.MarketName=a.marketName.replace(c[0],"").trim()):this.MarketName=a.marketName,(e&&0==a.spreadValue||0!=a.spreadValue)&&void 0==d?this.SelectionName=a.selectionName+" ("+a.spreadValue+")":this.SelectionName=a.selectionName,this.OddValue=a.oddValue,this.UnboostedOddValue=a.unboostedOddValue,this.SmartCode=a.smartBetCode,this.EventCategory=a.eventCategory,this.IDGroup=a.groupNo,this.GamePlay=a.combinability,this.IncompatibleEvents=a.incompatibleEvents,this.CompatibleMarkets=a.compatibleMarkets}}return a}();a.BetCouponOdd=h;var i=function(){function a(){}return a}();a.BetCouponGroup=i;var j=function(){function a(){}return a}();a.BetCouponGroupMissing=j,function(a){a[a.Ok=0]="Ok",a[a.UnderMinBetStake=1]="UnderMinBetStake",a[a.OverMaxBetStake=2]="OverMaxBetStake",a[a.CouponLimitReached=3]="CouponLimitReached",a[a.UnderMinBetGroupStake=8]="UnderMinBetGroupStake",a[a.OverMaxBetGroupStake=9]="OverMaxBetGroupStake"}(a.EvaluationMotivation||(a.EvaluationMotivation={}));var k=a.EvaluationMotivation,l=function(){function a(){this.IsVirtualsInstallation=!1}return a}();a.BetCouponGlobalVariable=l;var m=function(){function b(){var a=JSON.parse(sessionStorage.getItem("SportsbookGlobalVariable")||"{}");this.IsClientSideCoupon=!0,this.CurrencyId=a.CurrencyId||1,this.TaxPercentage=0,this.Stake=a.DefaultStakeGross||1,this.StakeGross=a.DefaultStakeGross||1,this.Odds=new Array,this.Groupings=new Array,this.PossibleMissingGroupings=new Array}return b.prototype.MaxGrouping=function(){var a=Number.MAX_VALUE,b=this.Odds.filter(function(a){return a.CompatibilityLevel==f.CompatibleMarket}).length,c=this.Odds.filter(function(a){return a.CompatibilityLevel==f.IncompatibleMarket}),d=c.unique("MatchId").length,e=b+d;return e>a?a:e},b.prototype.setAllowFixed=function(){for(var a=0;a<this.Odds.length;a++){var b=this.Odds[a],c=this.Odds.filter(function(a){return a.MatchId==b.MatchId&&a.SelectionId!=b.SelectionId});c.length>0?b.AllowFixed=!1:b.AllowFixed=!0}},b.prototype.setTotalOdds=function(){this.TotalOdds=this.Odds.reduce(function(a,b){return a*b.OddValue},1)},b.prototype.getTax=function(){return this.TaxPercentage/100},b.prototype.setTax=function(){this.Tax=this.getTax()},b.prototype.getStakeTaxed=function(){return this.StakeGross*this.getTax()},b.prototype.setStakeTaxed=function(){this.StakeTaxed=this.getStakeTaxed()},b.prototype.getStake=function(){return this.StakeGross-this.getStakeTaxed()},b.prototype.setStake=function(){this.Stake=this.getStake()},b.prototype.calculateAndSetTaxes=function(b,c,d){var e=a.TaxationService.Instance().getModule(c,d);if(e){var f=new Date,g=new a.TaxConfiguration(b.BetCouponGlobalVariable.IsVirtualsInstallation),h=e.calculateTurnoverTax(new a.TurnoverTaxParameter(f,this.Stake,g)),i=this.Groupings.map(function(b){var c=e.calculateWithholdingTax(new a.WithholdingTaxParameter(f,b.MinWinNet+b.MinBonus,b.NetStake,g));return b.MinWinNet=c.totalAfterTax,{winAfterTax:c.totalAfterTax,winTaxed:c.totalTaxed,bonus:b.MinBonus}}),j=this.Groupings.map(function(b){var c=e.calculateWithholdingTax(new a.WithholdingTaxParameter(f,b.MaxWinNet+b.MaxBonus,b.NetStake*b.Combinations,g));return b.MaxWinNet=c.totalAfterTax,{winAfterTax:c.totalAfterTax,winTaxed:c.totalTaxed,bonus:b.MaxBonus}});if(h&&(this.TurnoverTax=h.totalTaxed),i.length>0){var k=i.reduce(function(a,b){return Math.min(a,b.winAfterTax)},Number.MAX_VALUE),l=i.reduce(function(a,b){return Math.min(a,b.bonus)},Number.MAX_VALUE);this.MinWinNet=k,this.MinBonus=l,this.MinWithholdingTax=i.reduce(function(a,b){return Math.min(a,b.winTaxed)},Number.MAX_VALUE)}if(j){var k=j.reduce(function(a,b){return a+b.winAfterTax},0),m=j.reduce(function(a,b){return a+b.bonus},0);this.MaxWinNet=k,this.MaxBonus=m,this.MaxWithholdingTax=j.reduce(function(a,b){return a+b.winTaxed},0)}}},b}();a.BetCoupon=m,function(a){a[a.Success=0]="Success",a[a.SuccessFollowMutiple=1]="SuccessFollowMutiple",a[a.CouponContainsUniqueOddError=4]="CouponContainsUniqueOddError",a[a.CannotInsertUniqueOddError=5]="CannotInsertUniqueOddError",a[a.MaxNoOfSelectionsError=6]="MaxNoOfSelectionsError",a[a.MaxNoOfEventsError=7]="MaxNoOfEventsError",a[a.CannotInsertFixedOddOnCrossCombinationError=8]="CannotInsertFixedOddOnCrossCombinationError",a[a.IncompatibleEvents=11]="IncompatibleEvents",a[a.MinCombinabilityOddsError=12]="MinCombinabilityOddsError"}(a.AddOddResult||(a.AddOddResult={}));var n=a.AddOddResult;!function(a){a[a.Success=0]="Success",a[a.SuccessFollowMutiple=1]="SuccessFollowMutiple",a[a.OddNotExists=2]="OddNotExists",a[a.CannotRemoveOddError=3]="CannotRemoveOddError",a[a.CannotRemoveGroupingError=4]="CannotRemoveGroupingError",a[a.Error=5]="Error"}(a.RemoveOddResult||(a.RemoveOddResult={}));var o=a.RemoveOddResult,p=function(){function a(){}return a.prototype.convertAddOddResult=function(a){switch(a){case n.Success:return c.Success;case n.SuccessFollowMutiple:return c.Success;case n.CouponContainsUniqueOddError:return c.CouponContainsUniqueOddError;case n.CannotInsertUniqueOddError:return c.CannotInsertUniqueOddError;case n.MaxNoOfSelectionsError:return c.MaxNoOfSelectionsError;case n.MaxNoOfEventsError:return c.MaxNoOfEventsError;case n.CannotInsertFixedOddOnCrossCombinationError:return c.CannotInsertFixedOddOnCrossCombinationError;case n.IncompatibleEvents:return c.IncompatibleEvents;default:return c.Error}},a.prototype.convertRemoveOddResult=function(a){switch(a){case o.Success:return c.Success;case o.SuccessFollowMutiple:return c.Success;case o.OddNotExists:return c.OddNotExists;case o.CannotRemoveOddError:return c.CannotRemoveOddError;case o.CannotRemoveGroupingError:return c.CannotRemoveGroupingError;default:return c.Error}},a.prototype.convertEvaluationMotivation=function(a){switch(a){case k.Ok:return c.Success;case k.UnderMinBetStake:return c.UnderMinBetStake;case k.OverMaxBetStake:return c.OverMaxBetStake;case k.CouponLimitReached:return c.CouponLimitReached;case k.UnderMinBetGroupStake:return c.UnderMinBetGroupStake;case k.OverMaxBetGroupStake:return c.OverMaxBetGroupStake;default:return c.Error}},a}();a.ResponseStatusHelper=p}(Sportsbook||(Sportsbook={}));var Sportsbook;!function(a){var b=function(){function b(){"undefined"!=typeof Storage?this.localStorageEnabled=!0:this.localStorageEnabled=!1}return b.prototype.setItem=function(a,b){this.localStorageEnabled?sessionStorage.setItem(a,JSON.stringify(b)):this[a]=b},b.prototype.getItem=function(a){return this.localStorageEnabled?JSON.parse(sessionStorage.getItem(a)):this[a]},b.prototype.getBonusList=function(){return this.getItem("SportsbookBonusList")},b.prototype.setBonusList=function(a){this.setItem("SportsbookBonusList",a)},b.prototype.getGlobalVariables=function(){return this.getItem("SportsbookGlobalVariable")},b.prototype.setGlobalVariables=function(a){this.setItem("SportsbookGlobalVariable",a)},b.prototype.getMarketExceptionsList=function(){var b=this.getItem("SportsbookMarketsExceptionList");return null!=b?new a.Dictionary(this.getItem("SportsbookMarketsExceptionList")):null},b.prototype.setMarketExceptionsList=function(a){this.setItem("SportsbookMarketsExceptionList",a)},b}();a.LocalStorageManager=b}(Sportsbook||(Sportsbook={}));var Sportsbook;!function(a){var b=function(){function a(a,b){this.apiURL=a,this.apiToken=null,this.localStorageManager=b}return a.prototype.setApiToken=function(a){this.apiToken!=a&&(this.apiToken=a,this.populateGlobalVariables())},a.prototype.populateBonusList=function(){var a=this,b=this.apiURL+"api/settings/bonuslist";$.ajax(b,{async:!1,success:function(b){a.localStorageManager.setBonusList(b)}})},a.prototype.populateGlobalVariables=function(){var a=this,b=this.apiURL+"api/settings/globalvariables",c={"Content-Type":"application/json; charset=utf-8"};null!=this.apiToken&&(c.Authorization="Bearer "+this.apiToken),$.ajax(b,{headers:c,success:function(b){a.localStorageManager.setGlobalVariables(b)}})},a.prototype.populateMarketExceptionsList=function(){var a=this,b=this.apiURL+"api/settings/incompatiblemarketexceptions";$.getJSON(b,function(b){a.localStorageManager.setMarketExceptionsList(b)})},a}();a.APIService=b}(Sportsbook||(Sportsbook={}));var Sportsbook;!function(a){var b=function(){function b(){}return b.prototype.evaluate=function(b){var c=b.StakeGross,d=b.Groupings,e=b.BetCouponGlobalVariable;if(c>e.MaxBetStake)return a.EvaluationMotivation.OverMaxBetStake;for(var f=0;f<d.length;f++){var g=d[f];if(g.Stake>e.MaxGroupingsBetStake)return a.EvaluationMotivation.OverMaxBetGroupStake}var h=0;switch(b.CouponTypeId){case a.CouponType.SingleBet:h=e.MaxSingleBetWin;break;case a.CouponType.MultipleBet:h=e.MaxMultipleBetWin;break;case a.CouponType.CombinationsBet:h=e.MaxCombinationBetWin}return b.MaxWin>h?a.EvaluationMotivation.CouponLimitReached:a.EvaluationMotivation.Ok},b.prototype.getCouponType=function(b){if(0==b.Groupings.length)return a.CouponType.Unknown;for(var c=(b.Odds,{}),d=0;d<b.Odds.length;d++){var e=b.Odds[d];"undefined"==typeof c[e.MatchId]&&(c[e.MatchId]=new Array),c[e.MatchId].push(e)}var f=b.MaxGrouping(),g=0,h=0;for(var i in c){var j=c[i];j.filter(function(b){return b.CompatibilityLevel==a.CompatibilityLevel.CompatibleMarket}).length>0&&(g+=1),j.filter(function(b){return b.CompatibilityLevel==a.CompatibilityLevel.IncompatibleMarket}).length>1&&(h+=1)}return h>0?a.CouponType.CombinationsBet:1==f?a.CouponType.SingleBet:1==b.Groupings.length&&b.Groupings[0].Grouping==f&&0==g?a.CouponType.MultipleBet:b.Groupings.filter(function(a){return a.Grouping!=f}).length>0||1==b.Groupings.length&&b.Groupings[0].Grouping==f&&g>0?a.CouponType.CombinationsBet:a.CouponType.Unknown},b}(),c=function(){function b(){}return b.prototype.addOdd=function(b,c){var d=e.getMarketExceptionsList();
if(c.Odds.filter(function(a){return a.SelectionId==b.SelectionId||null!=b.IncompatibleEvents&&b.IncompatibleEvents.indexOf(a.MatchId)!=-1&&!(d.containsKey(b.MarketTypeId)&&d[b.MarketTypeId].indexOf(a.MarketTypeId)!=-1)}).length>0)return a.AddOddResult.IncompatibleEvents;var g=c.MaxGrouping(),h=c.Odds.filter(function(a){return a.MatchId==b.MatchId}),i=!1,j=!1;if(b.CompatibilityLevel=a.CompatibilityLevel.IncompatibleMarket,h.length>0&&(i=this.isCouponOddCompatible(c,b,h),i&&(j=h.length>1&&h.filter(function(b){return b.CompatibilityLevel==a.CompatibilityLevel.IncompatibleMarket}).length>0,b.CompatibilityLevel=j?a.CompatibilityLevel.IncompatibleMarket:a.CompatibilityLevel.CompatibleMarket)),c.Odds.length>=1){if(0==b.GamePlay)return a.AddOddResult.CannotInsertUniqueOddError;if(c.Odds.filter(function(a){return 0==a.GamePlay}).length>0)return a.AddOddResult.CouponContainsUniqueOddError}if(c.Odds.length>=c.BetCouponGlobalVariable.MaxNoOfSelections)return a.AddOddResult.MaxNoOfSelectionsError;if(c.Odds.unique("MatchId").length>=c.BetCouponGlobalVariable.MaxNoOfEvents&&0==c.Odds.filter(function(a){return a.MatchId==b.MatchId}).length)return a.AddOddResult.MaxNoOfEventsError;if(h.filter(function(b){return b.CompatibilityLevel==a.CompatibilityLevel.IncompatibleMarket}).length>=1){if(b.Fixed)return a.AddOddResult.CannotInsertFixedOddOnCrossCombinationError;for(var k=0;k<h.length;k++){var l=h[k];l.Fixed&&(l.Fixed=!1)}}if(i)j||1!=h.length||(h[0].CompatibilityLevel=a.CompatibilityLevel.CompatibleMarket);else if(h.filter(function(b){return b.CompatibilityLevel==a.CompatibilityLevel.CompatibleMarket}).length>0){for(var k=0;k<h.length;k++)h[k].CompatibilityLevel=a.CompatibilityLevel.IncompatibleMarket;c.Groupings=c.Groupings.filter(function(a){return a.Grouping<=c.MaxGrouping()})}return c.Odds.push(b),this.followMaxGrouping(c,g)?a.AddOddResult.SuccessFollowMutiple:(c.CouponTypeId=f.getCouponType(c),a.AddOddResult.Success)},b.prototype.isCouponOddCompatible=function(a,b,c){if(null==b.CompatibleMarkets||0==b.CompatibleMarkets.length)return!1;var d=c.filter(function(a){return a.SelectionId!=b.SelectionId});return d.every(function(a){return b.CompatibleMarkets.indexOf(a.MarketId)!=-1})},b.prototype.removeOdd=function(b,c){var d=b.Odds.filter(function(a){return a.SelectionId==c});if(d.length>0){var e=d[0],f=b.Odds.filter(function(b){return b.MatchId==e.MatchId&&b.CompatibilityLevel==a.CompatibilityLevel.IncompatibleMarket});if(e.CompatibilityLevel==a.CompatibilityLevel.IncompatibleMarket&&f.length>1)return this.removeOddInternal(b,e);if(b.Groupings.length>0){var g=b.Groupings.max("Grouping");return b.Groupings.remove("Grouping",g)?this.removeOddInternal(b,e):a.RemoveOddResult.CannotRemoveGroupingError}return this.removeOddInternal(b,e)}return a.RemoveOddResult.OddNotExists},b.prototype.addGroup=function(b,c,d,e){var g=new a.BetCouponGroup;g.Grouping=c,g.Combinations=d,g.Stake=e,b.Groupings.push(g),b.CouponTypeId=f.getCouponType(b)},b.prototype.removeGroup=function(a,b){a.Groupings.remove("Grouping",b.Grouping),a.CouponTypeId=f.getCouponType(a)},b.prototype.getTotalCombinations=function(a){return a.Groupings.length>0?a.Groupings.sum("Combinations"):0},b.prototype.truncateLastRoundedDecimalValue=function(a){var b=a.toString().indexOf("."),c=a.toString().substring(b+1).length,d=new RegExp("^-?\\d+(?:.\\d{0,"+(c-1)+"})?");return parseFloat(a.toString().match(d)[0])},b.prototype.setPossibleCouponStake=function(b,c){var d=b.BetCouponGlobalVariable;if(null==d)return void console.log("setPossibleCouponStake(): This function requires BetCouponGlobalVariable in BetCoupon to verify stake checks.");switch(b.CouponTypeId){case a.CouponType.SingleBet:case a.CouponType.Unknown:default:var e=0;if(0!=b.StakeGross&&(e=(b.StakeGross-b.Stake)/b.StakeGross),null!=d.StakeMod0Single&&0!=d.StakeMod0Single){var f=b.StakeGross%d.StakeMod0Single;if(0!=f){var g=b.StakeGross/d.StakeMod0Single,h=Math.round(g);0==h&&(h=1),b.StakeGross=h*d.StakeMod0Single}}b.StakeGross<d.MinBetStake&&(b.StakeGross=d.MinBetStake),b.Stake=b.StakeGross-b.StakeGross*e;for(var i=0,j=b.Groupings;i<j.length;i++){var k=j[i];k.Stake=b.Stake}break;case a.CouponType.MultipleBet:var l=0;if(0!=b.StakeGross&&(l=(b.StakeGross-b.Stake)/b.StakeGross),null!=d.StakeMod0Multiple&&0!=d.StakeMod0Multiple){var m=b.StakeGross%d.StakeMod0Multiple;if(0!=m){var n=b.StakeGross/d.StakeMod0Multiple,h=Math.round(n);0==h&&(h=1),b.StakeGross=h*d.StakeMod0Multiple}}b.StakeGross<d.MinBetStake&&(b.StakeGross=d.MinBetStake),b.Stake=b.StakeGross-b.StakeGross*l;for(var o=0,p=b.Groupings;o<p.length;o++){var k=p[o];k.Stake=b.Stake}break;case a.CouponType.CombinationsBet:for(var q=0,r=b.Groupings;q<r.length;q++){var k=r[q],s=d.MinGroupingsBetStake;if(0!=b.Stake){var t=k.Stake/b.Stake;t=this.truncateLastRoundedDecimalValue(t),s=Math.max(d.MinGroupingsBetStake,d.MinBetStake*t)}if(null!=d.StakeInnerMod0Combination&&0!=d.StakeInnerMod0Combination){var u=k.Stake%d.StakeInnerMod0Combination;if(0!=u){var v=k.Stake/d.StakeInnerMod0Combination,h=Math.round(v);0==h&&(h=1),k.Stake=h*d.StakeInnerMod0Combination}if(k.Stake<s){var w=s/d.StakeInnerMod0Combination,x=Math.ceil(w);0==x&&(x=1),k.Stake=x*d.StakeInnerMod0Combination}}}}},b.prototype.getMinWin=function(a){return a.Groupings.length>0?a.Groupings.min("MinWin"):0},b.prototype.getNetStakeMinWin=function(a){return a.Groupings.length>0?a.Groupings.min("MinWinNet"):0},b.prototype.getMaxWin=function(a){return a.Groupings.length>0?a.Groupings.sum("MaxWin"):0},b.prototype.getNetStakeMaxWin=function(a){return a.Groupings.length>0?a.Groupings.sum("MaxWinNet"):0},b.prototype.getMinBonus=function(a){return a.Groupings.length>0?a.Groupings.min("MinBonus"):0},b.prototype.getMaxBonus=function(a){return a.Groupings.length>0?a.Groupings.sum("MaxBonus"):0},b.prototype.getMinPercentageBonus=function(a){return a.Groupings.length>0?a.Groupings.min("MinPercentageBonus"):0},b.prototype.getMaxPercentageBonus=function(a){return a.Groupings.length>0?a.Groupings.max("MaxPercentageBonus"):0},b.prototype.getMinOdd=function(a){if(null!=a.Groupings&&a.Groupings.length>0){var b=a.Groupings.filter(function(a){return a.Stake>0}).sort(function(a,b){return a.MinWin-b.MinWin})[0];if(null!=b)return parseFloat((b.MinWin/b.Stake).toFixed(2))}return 0},b.prototype.getMaxOdd=function(a){if(null!=a.Groupings&&a.Groupings.length>0){var b=a.Groupings.filter(function(a){return a.Stake>0}).reduce(function(a,b){return a+b.MaxWin/b.Stake},0);return parseFloat(b.toFixed(2))}return 0},b.prototype.calculateAndUpdate=function(b,c,d,e,i){for(var j=h.calcCombinations(b),k=new Array,l=0;l<j.Groups.length;l++){var m=j.Groups[l],n=m.Combinations,o=b.Groupings.filter(function(a){return a.Grouping==m.Grouping});if(o.length>1)throw new Error("Multiple Groupings defined!");if(0==o.length){var p=new a.BetCouponGroup;p.Grouping=m.Grouping,p.Combinations=m.Combinations,k.push(p)}n<=0||n>b.BetCouponGlobalVariable.MaxCouponCombinations?o.length>0&&this.removeGroup(b,o[0]):o.length>0&&(o[0].Combinations=n)}if(0===b.Groupings.length&&k.length>=1){var q=k.filter(function(a){return a.Grouping>0&&1!==a.Grouping&&a.Grouping!==b.Odds.length}),r=q.pop();if(r){var s=new a.BetCouponGroup;s.Combinations=r.Combinations,s.Grouping=r.Grouping,b.Groupings.push(s),k=k.filter(function(a){return a.Grouping!==r.Grouping||a.Combinations!==r.Combinations})}}if(b.PossibleMissingGroupings=k,b.CouponTypeId=a.CouponType.SingleBet,b.TotalCombinations=this.getTotalCombinations(b),!c)for(var t=b.StakeGross/b.TotalCombinations,l=0;l<b.Groupings.length;l++){var u=b.Groupings[l];u.Stake=t}b.CouponTypeId=f.getCouponType(b);for(var v=parseFloat(b.StakeGross.toString()),w=0,l=0;l<b.Groupings.length;l++){var u=b.Groupings[l];w+=u.Stake*u.Combinations}if(w.toFixed(2)!=v.toFixed(2)){g.setPossibleCouponStake(b,!0),w=0;for(var l=0;l<b.Groupings.length;l++){var u=b.Groupings[l];w+=u.Stake*u.Combinations}}return b.StakeGross=w,j=h.calcPotentialWins(b,d,e,i),this.updateFromCalculatedCoupon(b,j),b.setAllowFixed(),b.setTax(),b.setStakeTaxed(),b.setStake(),b.setTotalOdds(),b.calculateAndSetTaxes(b,e,i),j},b.prototype.updateFromCalculatedCoupon=function(a,b){if(a.Groupings.length>0)for(var c=0;c<b.Groups.length;c++){var d=b.Groups[c],e=a.Groupings.filter(function(a){return a.Grouping==d.Grouping});if(e.length>0){var f=e[0];f.Combinations=d.Combinations,f.MaxBonus=d.MaxBonus(),f.MaxWin=d.MaxWin(),f.MaxWinNet=d.NetStakeMaxWin(),f.NetStakeMaxWin=d.NetStakeMaxWin(),f.MinBonus=d.MinBonus(),f.MinWin=d.MinWin(),f.MinWinNet=d.NetStakeMinWin(),f.NetStakeMinWin=d.NetStakeMinWin(),f.MinPercentageBonus=d.MinPercentageBonus,f.MaxPercentageBonus=d.MaxPercentageBonus,f.NetStake=d.StakeForCombinationTaxed}this.validate(f)||this.removeGroup(a,f)}a.TotalCombinations=this.getTotalCombinations(a),a.MinWin=this.getMinWin(a),a.NetStakeMinWin=this.getNetStakeMinWin(a),a.MaxWin=this.getMaxWin(a),a.NetStakeMaxWin=this.getNetStakeMaxWin(a),a.MinBonus=this.getMinBonus(a),a.MaxBonus=this.getMaxBonus(a),a.MinPercentageBonus=this.getMinPercentageBonus(a),a.MaxPercentageBonus=this.getMaxPercentageBonus(a),a.MinOdd=this.getMinOdd(a),a.MaxOdd=this.getMaxOdd(a)},b.prototype.validate=function(a){return a.Combinations>0&&a.Grouping>0},b.prototype.removeOddInternal=function(b,c){var d=b.MaxGrouping();if(b.Odds.remove("SelectionId",c.SelectionId)){var e=b.Odds.filter(function(a){return a.MatchId==c.MatchId});if(e.length<=0);else if(1==e.length)e[0].CompatibilityLevel=a.CompatibilityLevel.IncompatibleMarket;else for(var g=0;g<e.length;g++){var h=e[g],i=b.Odds.filter(function(a){return a.MatchId==h.MatchId}),j=a.CompatibilityLevel.IncompatibleMarket;if(e.length>0){var k=i.filter(function(b){return b.CompatibilityLevel==a.CompatibilityLevel.CompatibleMarket});if(k.length>0){k.unique("MarketId")}}h.CompatibilityLevel=j}return this.followMaxGrouping(b,d)?a.RemoveOddResult.SuccessFollowMutiple:(b.CouponTypeId=f.getCouponType(b),a.RemoveOddResult.Success)}return a.RemoveOddResult.CannotRemoveOddError},b.prototype.followMaxGrouping=function(a,b){return b!=a.MaxGrouping()&&(0==a.Odds.length?(a.Groupings=new Array,!1):(0==a.Groupings.length||1==a.Groupings.length&&a.Groupings[0].Grouping==b)&&(a.Groupings=new Array,this.addGroup(a,a.MaxGrouping(),0,0),!0))},b}(),d=function(){function c(c,d,f){this.apiService=new a.APIService(c,e),this.brandID=d,this.isRetailInstallation=f,this.couponEvaluator=new b}return c.prototype.setApiToken=function(a){this.apiService.setApiToken(a)},c.prototype.updateCoupon=function(b){var c=this.convertBetCoupon(b),d=this.updateBetCoupon(c,b.UseGroupsStake);return new a.BetCouponResponse(d,c)},c.prototype.removeSelection=function(b,c){var d=this.convertBetCoupon(c),e=new a.BetCouponOdd(b),f=this.removeCouponOdd(d,e.SelectionId,d.UseGroupsStake);return new a.BetCouponResponse(f,d)},c.prototype.addSelection=function(b,c){var d=new a.BetCoupon;d.Language=c;var e=new a.BetCouponOdd(b),f=this.getCouponOdd(d,e,!1);return new a.BetCouponResponse(f,d)},c.prototype.addSelectionToCoupon=function(b,c){var d=this.convertBetCoupon(c),e=new a.BetCouponOdd(b),f=this.getCouponOdd(d,e,d.UseGroupsStake);return new a.BetCouponResponse(f,d)},c.prototype.convertBetCoupon=function(b){var c=new a.BetCoupon;return $.extend(c,b),c},c.prototype.getCouponOdd=function(b,c,d){b.BetCouponGlobalVariable=e.getGlobalVariables();var f=i.convertAddOddResult(g.addOdd(c,b)),h=this.updateBetCoupon(b,d);return f==a.ResponseStatus.Success?h:f},c.prototype.removeCouponOdd=function(b,c,d){var e=i.convertRemoveOddResult(g.removeOdd(b,c)),f=this.updateBetCoupon(b,d);return e==a.ResponseStatus.Success?f:e},c.prototype.updateBetCoupon=function(a,b){var c=e.getBonusList();return g.calculateAndUpdate(a,b,c,this.brandID,this.isRetailInstallation),a.CurrentEvalMotivation=f.evaluate(a),a.IsClientSideCoupon=!0,i.convertEvaluationMotivation(a.CurrentEvalMotivation)},c}();a.CouponBuilder=d;var e=new a.LocalStorageManager,f=new b,g=new c,h=new a.CouponCalculation,i=new a.ResponseStatusHelper}(Sportsbook||(Sportsbook={}));var Sportsbook;!function(a){var b=function(b){function c(){b.apply(this,arguments),this.taxMode=a.TaxMode.TaxOnStakeAndWinnings}return __extends(c,b),c.prototype.turnoverTaxFunction=function(){return function(b,c){var d=0,e=0,f=0,g=c.stake,h=c.stake,i=0,j=[],k=b.filter(function(b){return b.type===a.TaxType.TurnoverTax&&b.validFrom<c.date&&(void 0===b.validTo||b.validTo>c.date)});return k.forEach(function(b){return e=void 0!==b.maxAmount?Math.min(g,b.maxAmount):g,g-=e,b.taxPercentage<=0?(i+=e,void(h-=e)):void(e<=0||(d=e*b.taxPercentage/(1+b.taxPercentage),c.taxConfiguration.twoDecimalPrecision&&(d=Math.round(100*d)/100),j.push(new a.TaxDetail({taxPercentage:b.taxPercentage,taxableAmount:e,taxedAmount:d})),h-=d,f+=d))}),new a.TaxResult({taxReason:a.TaxReason.TurnoverTax,totalAfterTax:Math.max(0,h+i),totalTaxed:Math.max(0,f),details:j})}},c.prototype.withholdingTaxFunction=function(){return function(b,c){var d=0,e=0,f=0,g=c.wonAmount-c.stake,h=c.wonAmount-c.stake,i=c.stake,j=[],k=b.filter(function(b){return b.type===a.TaxType.WithholdingTax&&b.validFrom<c.date&&(void 0===b.validTo||b.validTo>c.date)});return k.forEach(function(b){return e=void 0!==b.maxAmount?Math.min(g,b.maxAmount):g,g-=e,b.taxPercentage<=0?(i+=e,void(h-=e)):void(e<=0||(d=e*b.taxPercentage,c.taxConfiguration.twoDecimalPrecision&&(d=Math.round(100*d)/100),j.push(new a.TaxDetail({taxPercentage:b.taxPercentage,taxableAmount:e,taxedAmount:d})),h-=d,f+=d))}),new a.TaxResult({taxReason:a.TaxReason.WithholdingTax,totalAfterTax:Math.max(0,h+i),totalTaxed:Math.max(0,f),details:j})}},c}(a.AbstractFunction);a.KenyaTaxFunction=b}(Sportsbook||(Sportsbook={}));var Sportsbook;!function(a){!function(a){a[a.WithholdingTax=0]="WithholdingTax",a[a.TurnoverTax=1]="TurnoverTax"}(a.TaxType||(a.TaxType={}));a.TaxType}(Sportsbook||(Sportsbook={}));var Sportsbook;!function(a){var b=function(){function b(b,c){this.taxBrackets=[],this.taxMode=a.TaxMode.TaxOnStakeAndWinnings,this.taxBrackets.push(new a.TaxBracket({taxationOrder:0,type:a.TaxType.TurnoverTax,maxAmount:void 0,validFrom:new Date(2021,6,1),validTo:void 0,taxPercentage:.075}),new a.TaxBracket({taxationOrder:1,type:a.TaxType.WithholdingTax,maxAmount:void 0,validFrom:new Date(2019,11,1),validTo:void 0,taxPercentage:.2})),this.brandID=b,this.isRetail=c}return b.prototype.calculateTurnoverTax=function(b){return a.FunctionRepository.Instance().calculateTurnoverTax(this.taxMode)(this.taxBrackets,b)},b.prototype.calculateWithholdingTax=function(b){return a.FunctionRepository.Instance().calculateWithholdingTax(this.taxMode)(this.taxBrackets,b)},b}();a.KenyaTaxModule=b}(Sportsbook||(Sportsbook={}));
//# sourceMappingURL=clientSideCoupon.min.js.map